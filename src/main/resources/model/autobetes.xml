<?xml version="1.0" encoding="UTF-8"?>
<molgenis name="org.molgenis.autobetes">
	<module name="autobetes">
		<entity name="Event" implements="IdentificationApp">
			<field name="name" description="Name of event"/>
			<field name="owner" type="xref" xref_entity="MolgenisUser" nillable="true" description="User to which the event belongs. Is nillable for development purposes."/>
			<field name="eventType" type="enum" default="food" enum_options="[food,activity]" description="Event" />
		</entity>
		<entity name="EventInstance" implements="IdentificationApp">
			<field name="event" type="xref" xref_entity="Event" description="Event that happend."/>
			<field name="beginTime" type="long" nillable="true" description="Moment on which event begins. In milliseconds since 1970 in GMT. Null if not applicable." />
		</entity>
		<entity name="FoodEventInstance" extends="EventInstance">
			<field name="amount" type="decimal" nillable="false" description="Number of times this food is consumed." />
		</entity>
		<entity name="ActivityEventInstance" extends="EventInstance">
			<field name="intensity" type="decimal" default="5" nillable="false" description="Intensity of activity. 1=v. light, ..., 5=normal, ..., 10=v. heavy." />
			<field name="endTime" type="long" description="Moment when event ends. In milliseconds since 1970 in GMT. Null for Food events." nillable="true"/>
		</entity>	
		<entity name="IdentificationApp" abstract="true">
			<field name="id" type="autoid" description="Autogenerated id that uniquely identifies this record." />
			<field name="lid" type="int" nillable="true" description="Local ID (exists only in app) and is irrelevant on server. Column 'id' is the universal unique identifier of this record." />
			<field name="owner" type="xref" xref_entity="MolgenisUser" nillable="true" description="User to which this record belongs. Is nillable for development purposes."/>
			<field name="moment" type="string" unique="true" nillable="true" description="Store date/time 'as you see it on your watch' so that we can check whether it corresponds to 'unixtime' after correcting for time zone and day light saving." />
			<field name="deleted" type="boolean" default="false" description="Indicates whether this record is deleted." />
			<field name="lastchanged" type="long" description="Moment when this record was created or last changed (bookkeeping). In milliseconds since 1970 in GMT." />
		</entity>
		<entity name="LastSynced" description="This table lives only on clients.">
			<field name="id" type="autoid" description="Client should autogenerate an id that uniquely identifies this record." />
			<field name="timestamp" type="long" description="Before sync'ing app with server a transaction is started. At the beginning of this transaction, the current time is stored." />
		</entity>
		
		<entity name="IdentificationServer" abstract="true">
			<field name="id" type="autoid" description="Autogenerated id that uniquely identifies this record." />
			<field name="owner" type="xref" xref_entity="MolgenisUser" nillable="true" description="User to which this record belongs. Is nillable for development purposes."/>
			<field name="moment" type="string" unique="true" nillable="true" description="Store date/time 'as you see it on your watch'." />
			<field name="unixtimeOriginal" type="long" description="Moment on which 'measurement' was acquired. In ms since 1970, as stored in the pump. Local time. No correction for DLS or time zone. Null if not applicable." />
			<field name="unixtimeCorrected" type="long" nillable="true" description="Orginal unixtime: ms since 1970 in GMT. Corrected for time zone and DLS. Also corrected for small time adjustments." />
		</entity>
	
		<entity name="Bgmeter" implements="IdentificationServer">
			<field name="value" type="decimal" />
		</entity>
	
		<entity name="Bgsensor" implements="IdentificationServer">
			<field name="value" type="decimal" />
		</entity>
		<entity name="Carbs" implements="IdentificationServer">
			<field name="value" type="decimal" description="Amount of consumed carbohydrates (gram)." />
		</entity>
		<entity name="Bolus" implements="IdentificationServer">
			<field name="programmedAmount" type="decimal" description="Intended amount of insulin (IE)." />
			<field name="amount" type="decimal" description="Actual amount of injected insulin (IE)." />
			<field name="square" type="boolean" description="false = normal bolus, true = square wave bolus." />
			<field name="duration" type="decimal" nillable="true" description="Period in which bolus is uniformly injected (ms). If !square = true, then duration is not defined." />
		</entity>
		<entity name="BasalProgrammed" implements="IdentificationServer" description="Programmed basal profile.">
			<field name="patternName" type="string" description="Name of this basal insulin profile." />
			<field name="profileIndex" type="int" description="Index of this insulin profile (0, 1, ...)." />
			<field name="rate" type="decimal" description="IE/hour" />
			<field name="startTime" type="int" description="Start time of this basal profile (in ms since 0:00h)." />
		</entity>
		<entity name="BasalTemp" implements="IdentificationServer" description="Basal profile temporary change.">
			<!-- isn't field 'amount' missing here? -->
			<field name="fraction" type="decimal" description="Fraction of basal profile." />
			<field name="duration" type="int" description="Duration of this temporal change of the basal profile (in ms)." />
		</entity>
		<entity name="BasalSetting" implements="IdentificationServer" description="Basal profile setting, taking into account the programmed amount and the temporal change.">
			<field name="rate" type="decimal" description="IE/hour" />
		</entity>
		<entity name="Basal" implements="IdentificationServer" description="Basal bolus as it may be released in practice.">
			<field name="rate" type="decimal" description="IE/hour" />
		</entity>
		<entity name="Exercise" implements="IdentificationServer" description="Exercise start.">
		</entity>
	
		<entity name="ModelParameterInsulin" description="Parameters for insulin in the model.">
			<field name="id" type="autoid" description="autogenerated id number (autoid)" />
			<field name="insulinName" type="string" description="Name of this insulin." />
			<field name="peak" type="decimal" description="Period (minutes) after which insulin reaches peak" />
			<field name="pct95" type="decimal" unique="true" description="Period (minutes) after which 95% of insulin is absorbed" />
		</entity>		
		<entity name="ModelParameterCarbs" description="Parameters for carbs in the model.">
			<field name="id" type="autoid" description="autogenerated id number (autoid)." />
			<field name="carbType" type="enum" enum_options="[vquick, quick,normal,slow, vslow]" description="Type of carbs. Each food can be seen as a waited sum of slow, normal and quick carbs." />
			<field name="peak" type="decimal" description="Period (minutes) after which carb intake reaches peak." />
			<field name="pct95" type="decimal" unique="true" description="Period (minutes) after which 95% of carbs is absorbed." />
			<field name="glycIndex" type="decimal" nillable="true" description="Glycemic index of this food. This parameter is optional." />
		</entity>
		
		<entity name="Grid" description="Grid with data. Can be of type bg, delta bg, ins, carb, and activity">
			<field name="id" type="autoid" description="autogenerated id number (autoid)." />
			<field name="name" type="enum" enum_options="[bg,dbg,ins,carb,act]" description="Type of values in grid." />
			<field name="insulin" type="xref" xref_entity="ModelParameterInsulin" nillable="true" description="Parameters we need to model insulin bolus." />
			<field name="carbs" type="xref" xref_entity="ModelParameterCarbs" nillable="true" description="Parameters we need to model insulin bolus." />
			<field name="matrix" type="text" description="A matrix (R-object) with bg, or delta bg, or insulin, or carb, or exercise per moment of day." />
		</entity>

	</module>
</molgenis>